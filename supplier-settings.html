<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Supplier Settings - Operix</title>
<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
  body { 
    font-family: 'Inter', sans-serif; 
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  
  .animate-slideIn {
    animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .animate-fadeIn {
    animation: fadeIn 0.3s ease-out;
  }
  
  .sidebar-item {
    position: relative;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .sidebar-item:hover {
    background: rgba(102, 126, 234, 0.05);
    transform: translateX(4px);
  }
  
  .sidebar-item.active {
    background: linear-gradient(to right, rgba(102, 126, 234, 0.1), transparent);
    color: #667eea;
    font-weight: 600;
  }
  
  .sidebar-item.active::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
    border-radius: 0 4px 4px 0;
  }
  
  .content-section {
    animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .input-field {
    transition: all 0.2s ease;
  }
  
  .input-field:focus {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
  }
  
  .btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    transition: all 0.3s ease;
  }
  
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
  }
  
  .btn-primary:active {
    transform: translateY(0);
  }
  
  .settings-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    transition: all 0.2s ease;
  }
  
  .settings-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }
  
  .option-item {
    transition: all 0.2s ease;
  }
  
  .option-item:hover {
    background: #f9fafb;
    transform: translateX(4px);
  }
  
  .delete-btn {
    opacity: 0;
    transition: all 0.2s ease;
  }
  
  .option-item:hover .delete-btn {
    opacity: 1;
  }
</style>
</head>
<body class="bg-gray-50">
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

// Icons
const ArrowLeft = () => (
  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
  </svg>
);

const Settings = () => (
  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
  </svg>
);

const Code = () => (
  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
  </svg>
);

const Upload = () => (
  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
  </svg>
);

const Download = () => (
  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
  </svg>
);

const CreditCard = () => (
  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
  </svg>
);

const DollarSign = () => (
  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
);

const Truck = () => (
  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z" />
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0" />
  </svg>
);

const Calendar = () => (
  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
  </svg>
);

const Plus = () => (
  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
  </svg>
);

const Trash = () => (
  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
  </svg>
);

const Save = () => (
  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
  </svg>
);

const OperixLogo = ({ size = 'default' }) => {
  const dimensions = size === 'small' ? { w: 32, h: 32 } : { w: 40, h: 40 };
  
  return (
    <svg width={dimensions.w} height={dimensions.h} viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
      <rect width="40" height="40" rx="8" fill="#667eea"/>
      <path d="M20 10 C25 10 28 13 28 18 C28 23 25 26 20 26 C15 26 12 23 12 18 C12 13 15 10 20 10 Z M20 14 C17 14 16 15.5 16 18 C16 20.5 17 22 20 22 C23 22 24 20.5 24 18 C24 15.5 23 14 20 14 Z" fill="white"/>
      <rect x="18" y="26" width="4" height="4" fill="white"/>
    </svg>
  );
};

function SupplierSettings() {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [uploading, setUploading] = useState(false);
  const [activeSection, setActiveSection] = useState('code');
  
  const [supplierSettings, setSupplierSettings] = useState({
    codePrefix: 'SUP',
    startingNumber: 1,
    paymentTermsOptions: ['30 Days', '60 Days', '90 Days', 'COD', 'Net 15'],
    currencyOptions: ['PHP', 'USD', 'EUR', 'JPY'],
    shipmentModeOptions: ['Air Freight', 'Sea Freight', 'Land Transport', 'Courier'],
    paymentMethodOptions: ['Check', 'Wired', 'Cash', 'Bank Transfer'],
    termsDateBasisOptions: ['Invoice Date', 'Goods Received', 'Invoice Received']
  });

  useEffect(() => {
    const initFirebase = () => {
      const firebaseConfig = {
        apiKey: "AIzaSyB56dPmBwgO4uWyXakhY9SJBCAz7bk0Do8",
        authDomain: "operix-c8a8c.firebaseapp.com",
        projectId: "operix-c8a8c",
        storageBucket: "operix-c8a8c.firebasestorage.app",
        messagingSenderId: "794223223499",
        appId: "1:794223223499:web:f059007b909cc15766f14e",
        measurementId: "G-6E4BD657K1"
      };

      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }

      const auth = firebase.auth();
      auth.onAuthStateChanged(async (currentUser) => {
        if (currentUser) {
          const db = firebase.firestore();
          const userDoc = await db.collection('users').doc(currentUser.uid).get();
          
          if (userDoc.exists && userDoc.data().role === 'admin') {
            setUser({
              uid: currentUser.uid,
              email: currentUser.email,
              ...userDoc.data()
            });
            
            await loadSupplierSettings(db, currentUser.uid);
          } else {
            window.location.href = 'login.html';
          }
        } else {
          window.location.href = 'login.html';
        }
        setLoading(false);
      });
    };

    initFirebase();
  }, []);

  const loadSupplierSettings = async (db, userId) => {
    try {
      const settingsDoc = await db.collection('supplierSettings').doc(userId).get();
      if (settingsDoc.exists) {
        const data = settingsDoc.data();
        setSupplierSettings({
          codePrefix: data.codePrefix || 'SUP',
          startingNumber: data.startingNumber || 1,
          paymentTermsOptions: data.paymentTermsOptions || ['30 Days', '60 Days', '90 Days', 'COD', 'Net 15'],
          currencyOptions: data.currencyOptions || ['PHP', 'USD', 'EUR', 'JPY'],
          shipmentModeOptions: data.shipmentModeOptions || ['Air Freight', 'Sea Freight', 'Land Transport', 'Courier'],
          paymentMethodOptions: data.paymentMethodOptions || ['Check', 'Wired', 'Cash', 'Bank Transfer'],
          termsDateBasisOptions: data.termsDateBasisOptions || ['Invoice Date', 'Goods Received', 'Invoice Received']
        });
      }
    } catch (error) {
      console.error('Error loading supplier settings:', error);
    }
  };

  const saveSupplierSettings = async () => {
    try {
      setSaving(true);
      const db = firebase.firestore();
      await db.collection('supplierSettings').doc(user.uid).set({
        ...supplierSettings,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      
      // Success notification
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 z-50 animate-fadeIn';
      notification.innerHTML = `
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span class="font-semibold">Settings saved successfully!</span>
      `;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 3000);
      
    } catch (error) {
      console.error('Error saving supplier settings:', error);
      alert('Error saving settings. Please try again.');
    } finally {
      setSaving(false);
    }
  };



// Encryption key - MUST MATCH supplier-setup.html
const ENCRYPTION_KEY = 'your-secret-key-change-this-in-production-use-env-variable';

const encryptData = (data) => {
  if (!data || data.trim() === '') return '';
  return CryptoJS.AES.encrypt(data, ENCRYPTION_KEY).toString();
};





  const handleFileUpload = async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const fileType = file.name.split('.').pop().toLowerCase();
    if (fileType !== 'csv' && fileType !== 'xlsx') {
      alert('Please upload a CSV or Excel file');
      return;
    }

    setUploading(true);

    try {
      const reader = new FileReader();
      
reader.onload = async (event) => {
  const text = event.target.result;
  
  // Parse CSV properly handling quoted fields with newlines
  const rows = [];
  let currentRow = [];
  let currentField = '';
  let inQuotes = false;
  
  for (let i = 0; i < text.length; i++) {
    const char = text[i];
    const nextChar = text[i + 1];
    
    if (char === '"') {
      if (inQuotes && nextChar === '"') {
        // Escaped quote
        currentField += '"';
        i++; // Skip next quote
      } else {
        // Toggle quote state
        inQuotes = !inQuotes;
      }
    } else if (char === ',' && !inQuotes) {
      // Field separator
      currentRow.push(currentField.trim());
      currentField = '';
    } else if ((char === '\n' || char === '\r') && !inQuotes) {
      // Row separator (handle both \n and \r\n)
      if (char === '\r' && nextChar === '\n') {
        i++; // Skip \n in \r\n
      }
      if (currentField || currentRow.length > 0) {
        currentRow.push(currentField.trim());
        rows.push(currentRow);
        currentRow = [];
        currentField = '';
      }
    } else {
      currentField += char;
    }
  }
  
  // Add last field and row
  if (currentField || currentRow.length > 0) {
    currentRow.push(currentField.trim());
    rows.push(currentRow);
  }
        
        const headers = rows[0].map(h => h.toLowerCase().replace(/\s+/g, ''));
        const dataRows = rows.slice(1).filter(row => row.some(cell => cell.trim()));
        
        console.log('CSV Headers:', headers);
        console.log('Total data rows:', dataRows.length);
        
        const db = firebase.firestore();
        const batch = db.batch();
        let successCount = 0;
        let errorCount = 0;
        const errors = [];

        for (let rowIndex = 0; rowIndex < dataRows.length; rowIndex++) {
          const row = dataRows[rowIndex];
          
          try {
            // Create object mapping headers to values
            const supplierData = {};
            headers.forEach((header, index) => {
              supplierData[header] = row[index] ? row[index].trim() : '';
            });
            
// Validate required fields
if (!supplierData.name || !supplierData.email) {
  errors.push(`Row ${rowIndex + 2}: Missing required fields (Name: "${supplierData.name}", Email: "${supplierData.email}")`);
  errorCount++;
  continue;
}

// Generate supplier code
const counterRef = db.collection('supplierCounters').doc(user.uid);
const counterDoc = await counterRef.get();
let nextNumber = supplierSettings.startingNumber;

if (counterDoc.exists) {
  nextNumber = counterDoc.data().count + 1;
  await counterRef.update({ count: firebase.firestore.FieldValue.increment(1) });
} else {
  await counterRef.set({ count: supplierSettings.startingNumber });
}

const supplierCode = `${supplierSettings.codePrefix}-${String(nextNumber).padStart(4, '0')}`;

// Create comprehensive supplier object with all fields
const supplierRef = db.collection('suppliers').doc();
const completeSupplierData = {
  // Auto-generated
  supplierCode,
  createdBy: user.uid,
  createdAt: firebase.firestore.FieldValue.serverTimestamp(),
  updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
  importedFrom: 'bulk_upload', // ‚Üê ADD THIS LINE
  
  // Basic Information
  name: supplierData.name || '',
  email: supplierData.email || '',
  contactPerson: supplierData.contactperson || '',
  address: supplierData.address || '',
  phoneNumber: supplierData.phonenumber || '',
  
  // Payment & Financial
  paymentMethod: supplierData.paymentmethod || '',
  paymentTerms: supplierData.paymentterms || '30 Days',
  termsDateBasis: supplierData.termsdatebasis || '',
  currency: supplierData.currency || 'PHP',
  creditLimit: supplierData.creditlimit || '',
  discountRate: supplierData.discountrate || '',
  
  // Shipping
  modeOfShipment: supplierData.modeofshipment || 'Air Freight',
  
  // Company Profile
  registrationNumber: supplierData.registrationnumber ? encryptData(supplierData.registrationnumber) : '',
  dateEstablished: supplierData.dateestablished || '',
  businessType: supplierData.businesstype || '',
  industry: supplierData.industry || '',
  website: supplierData.website || '',
  faxNumber: supplierData.faxnumber || '',
  
  // Tax Information - ENCRYPTED
  taxId: supplierData.taxid ? encryptData(supplierData.taxid) : '',
  vatNumber: supplierData.vatnumber ? encryptData(supplierData.vatnumber) : '',
  taxExempt: supplierData.taxexempt === 'Yes' || supplierData.taxexempt === 'yes' || supplierData.taxexempt === 'TRUE' || supplierData.taxexempt === 'true' || supplierData.taxexempt === '1',
  taxExemptionReason: supplierData.taxexemptionreason || '',
  
  // Banking Information - ENCRYPTED
  bankName: supplierData.bankname ? encryptData(supplierData.bankname) : '',
  accountHolderName: supplierData.accountholdername ? encryptData(supplierData.accountholdername) : '',
  accountNumber: supplierData.accountnumber ? encryptData(supplierData.accountnumber) : '',
  swiftCode: supplierData.swiftcode ? encryptData(supplierData.swiftcode) : '',
  iban: supplierData.iban ? encryptData(supplierData.iban) : '',
  routingNumber: supplierData.routingnumber ? encryptData(supplierData.routingnumber) : '',
  
  // Additional
  notes: supplierData.notes || ''
};

// Debug log for first complete supplier data
if (rowIndex === 0) {
  console.log('Complete supplier data being saved:', {
    name: completeSupplierData.name,
    taxId: completeSupplierData.taxId ? 'ENCRYPTED' : 'EMPTY',
    bankName: completeSupplierData.bankName ? 'ENCRYPTED' : 'EMPTY',
    accountNumber: completeSupplierData.accountNumber ? 'ENCRYPTED' : 'EMPTY'
  });
}
        
            batch.set(supplierRef, completeSupplierData);
            successCount++;
            
          } catch (rowError) {
            console.error(`Error processing row ${rowIndex + 2}:`, rowError);
            errors.push(`Row ${rowIndex + 2}: ${rowError.message}`);
            errorCount++;
          }
        }
        
        // Commit batch
        if (successCount > 0) {
          await batch.commit();
        }
        
        setUploading(false);
        
        // Show results
        let message = `‚úÖ Successfully imported ${successCount} suppliers!`;
        if (errorCount > 0) {
          message += `\n‚ö†Ô∏è ${errorCount} rows had errors.`;
          if (errors.length > 0) {
            message += '\n\nErrors:\n' + errors.slice(0, 5).join('\n');
            if (errors.length > 5) {
              message += `\n... and ${errors.length - 5} more errors.`;
            }
          }
        }
        
        alert(message);
        
        e.target.value = '';
      };
      
      reader.readAsText(file);
    } catch (error) {
      console.error('Error uploading file:', error);
      alert('Error importing suppliers: ' + error.message);
      setUploading(false);
    }
  };

  const downloadTemplate = () => {
    const headers = [
      'Name', 'Email', 'Contact Person', 'Address', 'Phone Number', 
      'Payment method', 'Payment Terms', 'Terms Date Basis', 'Currency', 'Mode of Shipment',
      'Registration Number', 'Date Established', 'Business Type', 'Industry', 'Website', 'Fax Number',
      'Tax ID', 'VAT Number', 'Tax Exempt',
      'Bank Name', 'Account Holder Name', 'Account Number', 'SWIFT Code', 'IBAN', 'Routing Number',
      'Credit Limit', 'Discount Rate', 'Notes'
    ];
    
    const exampleRow = [
      'Example Supplier Inc.', 'supplier@example.com', 'John Doe', '123 Main St, City, Country', '+1234567890',
      'Bank Transfer', '30 Days', 'Invoice Date', 'PHP', 'Air Freight',
      'REG123456', '2020-01-15', 'Corporation', 'Manufacturing', 'https://example.com', '+1234567891',
      '123-456-789', 'VAT123456', 'No',
      'ABC Bank', 'Example Supplier Inc.', '1234567890', 'ABCDUS33', 'US12345678901234567890', '123456789',
      '100000', '5', 'Preferred supplier for raw materials'
    ];
    
    const csvContent = headers.join(',') + '\n' + exampleRow.join(',') + '\n';
    
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'supplier_import_template_complete.csv';
    a.click();
    window.URL.revokeObjectURL(url);
  };

  const handleLogout = async () => {
    try {
      await firebase.auth().signOut();
      window.location.href = 'login.html';
    } catch (error) {
      console.error('Logout error:', error);
    }
  };

  const menuItems = [
    { id: 'code', label: 'Supplier Code', icon: Code },
    { id: 'import', label: 'Import & Export', icon: Upload },
    { id: 'payment', label: 'Payment Terms', icon: CreditCard },
    { id: 'currency', label: 'Currency', icon: DollarSign },
    { id: 'shipment', label: 'Shipment Modes', icon: Truck },
    { id: 'paymentMethod', label: 'Payment Methods', icon: CreditCard },
    { id: 'dateBasis', label: 'Date Basis', icon: Calendar }
  ];

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600 font-medium">Loading Settings...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Top Header */}
      <header className="bg-white border-b border-gray-200 sticky top-0 z-30 shadow-sm">
        <div className="px-6 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <button
                onClick={() => window.location.href = 'dashboard.html'}
                className="flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-all"
              >
                <ArrowLeft />
                <span className="font-medium">Back to Dashboard</span>
              </button>
              <div className="h-8 w-px bg-gray-200"></div>
              <div className="flex items-center gap-3">
                <OperixLogo size="small" />
                <div>
                  <h1 className="text-xl font-bold text-gray-900">Supplier Settings</h1>
                  <p className="text-xs text-gray-500">Configure supplier management</p>
                </div>
              </div>
            </div>
            <div className="flex items-center gap-3">
              <button
                onClick={saveSupplierSettings}
                disabled={saving}
                className="btn-primary px-6 py-2.5 text-white rounded-lg font-medium flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {saving ? (
                  <>
                    <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    Saving...
                  </>
                ) : (
                  <>
                    <Save />
                    Save Settings
                  </>
                )}
              </button>
              <button
                onClick={handleLogout}
                className="px-4 py-2.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg font-medium transition-all"
              >
                Logout
              </button>
            </div>
          </div>
        </div>
      </header>

      <div className="flex h-[calc(100vh-73px)]">
        {/* Sidebar */}
        <aside className="w-72 bg-white border-r border-gray-200 overflow-y-auto">
          <div className="p-6">
            <div className="mb-6">
              <h2 className="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">Settings Menu</h2>
            </div>
            <nav className="space-y-1">
              {menuItems.map((item) => {
                const Icon = item.icon;
                const isActive = activeSection === item.id;
                
                return (
                  <button
                    key={item.id}
                    onClick={() => setActiveSection(item.id)}
                    className={`sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left transition-all ${
                      isActive ? 'active' : 'text-gray-700 hover:text-gray-900'
                    }`}
                  >
                    <Icon />
                    <span className="text-sm font-medium">{item.label}</span>
                  </button>
                );
              })}
            </nav>
          </div>
        </aside>

        {/* Main Content */}
        <main className="flex-1 overflow-y-auto">
          <div className="p-8">
            {/* Supplier Code Settings */}
            {activeSection === 'code' && (
              <div className="content-section max-w-4xl">
                <div className="mb-6">
                  <h2 className="text-2xl font-bold text-gray-900 mb-2">Supplier Code Settings</h2>
                  <p className="text-gray-600">Configure automatic supplier code generation format</p>
                </div>

                <div className="settings-card p-6">
                  <div className="grid grid-cols-2 gap-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Code Prefix</label>
                      <input
                        type="text"
                        value={supplierSettings.codePrefix}
                        onChange={(e) => setSupplierSettings({...supplierSettings, codePrefix: e.target.value.toUpperCase()})}
                        placeholder="SUP"
                        className="input-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none font-mono text-lg"
                      />
                      <p className="text-xs text-gray-500 mt-2">Examples: SUP, PUR, VEND</p>
                    </div>
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Starting Number</label>
                      <input
                        type="number"
                        min="1"
                        value={supplierSettings.startingNumber}
                        onChange={(e) => setSupplierSettings({...supplierSettings, startingNumber: parseInt(e.target.value) || 1})}
                        className="input-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none font-mono text-lg"
                      />
                      <div className="mt-3 p-3 bg-purple-50 rounded-lg border border-purple-200">
                        <p className="text-xs font-semibold text-purple-700 mb-1">Preview:</p>
                        <p className="text-lg font-bold text-purple-600 font-mono">
                          {supplierSettings.codePrefix}-{String(supplierSettings.startingNumber).padStart(4, '0')}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* Import & Export */}
            {activeSection === 'import' && (
              <div className="content-section max-w-4xl">
                <div className="mb-6">
                  <h2 className="text-2xl font-bold text-gray-900 mb-2">Import & Export</h2>
                  <p className="text-gray-600">Bulk import suppliers from CSV or Excel files with complete data</p>
                </div>

                <div className="settings-card p-6">
                  <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <div className="flex items-start gap-3">
                      <div className="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center flex-shrink-0">
                        <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                      </div>
                      <div className="flex-1">
                        <p className="font-semibold text-blue-900 mb-2">Complete Template with All Fields</p>
                        <p className="text-sm text-blue-800 mb-3">The template includes all 28 fields:</p>
                        <div className="grid grid-cols-2 gap-2 text-xs text-blue-700">
                          <div>
                            <p className="font-semibold mb-1">üìã Basic Info:</p>
                            <ul className="list-disc list-inside space-y-0.5">
                              <li>Name, Email, Contact Person</li>
                              <li>Address, Phone Number</li>
                            </ul>
                          </div>
                          <div>
                            <p className="font-semibold mb-1">üí≥ Payment & Financial:</p>
                            <ul className="list-disc list-inside space-y-0.5">
                              <li>Payment Method, Terms, Date Basis</li>
                              <li>Currency, Credit Limit, Discount</li>
                            </ul>
                          </div>
                          <div>
                            <p className="font-semibold mb-1">üè¢ Company Profile:</p>
                            <ul className="list-disc list-inside space-y-0.5">
                              <li>Registration, Established Date</li>
                              <li>Business Type, Industry, Website</li>
                            </ul>
                          </div>
                          <div>
                            <p className="font-semibold mb-1">üè¶ Banking & Tax:</p>
                            <ul className="list-disc list-inside space-y-0.5">
                              <li>Bank Details, Account Info</li>
                              <li>Tax ID, VAT Number, Tax Exempt</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <button
                      onClick={downloadTemplate}
                      className="flex items-center justify-center gap-2 px-6 py-3 bg-white border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 hover:border-gray-400 transition-all"
                    >
                      <Download />
                      Download Complete Template
                    </button>
                    
                    <label className={`flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium cursor-pointer transition-all ${
                      uploading 
                        ? 'bg-gray-400 cursor-not-allowed' 
                        : 'bg-green-500 hover:bg-green-600'
                    } text-white`}>
                      {uploading ? (
                        <>
                          <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                          Importing...
                        </>
                      ) : (
                        <>
                          <Upload />
                          Upload File
                        </>
                      )}
                      <input
                        type="file"
                        accept=".csv,.xlsx"
                        onChange={handleFileUpload}
                        disabled={uploading}
                        className="hidden"
                      />
                    </label>
                  </div>
                  
                  <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <p className="text-sm text-yellow-800">
                      <strong>üí° Tips:</strong>
                    </p>
                    <ul className="text-xs text-yellow-700 mt-2 space-y-1 list-disc list-inside">
                      <li>Only <strong>Name</strong> and <strong>Email</strong> are required fields</li>
                      <li>All other fields are optional - leave blank if not available</li>
                      <li>Tax Exempt: Use "Yes", "No", "TRUE", "FALSE", "1", or "0"</li>
                      <li>Dates should be in YYYY-MM-DD format (e.g., 2020-01-15)</li>
                      <li>Currency codes: PHP, USD, EUR, JPY, etc.</li>
                    </ul>
                  </div>
                </div>
              </div>
            )}

            {/* Payment Terms */}
            {activeSection === 'payment' && (
              <div className="content-section max-w-4xl">
                <div className="mb-6 flex items-center justify-between">
                  <div>
                    <h2 className="text-2xl font-bold text-gray-900 mb-2">Payment Terms</h2>
                    <p className="text-gray-600">Manage available payment term options</p>
                  </div>
                  <button
                    onClick={() => {
                      setSupplierSettings({
                        ...supplierSettings,
                        paymentTermsOptions: [...supplierSettings.paymentTermsOptions, 'New Term']
                      });
                    }}
                    className="flex items-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all"
                  >
                    <Plus />
                    Add Term
                  </button>
                </div>

                <div className="settings-card p-6">
                  <div className="space-y-3">
                    {supplierSettings.paymentTermsOptions.map((term, idx) => (
                      <div key={idx} className="option-item flex items-center gap-3 p-3 rounded-lg border border-gray-200">
                        <div className="flex-1">
                          <input
                            type="text"
                            value={term}
                            onChange={(e) => {
                              const newTerms = [...supplierSettings.paymentTermsOptions];
                              newTerms[idx] = e.target.value;
                              setSupplierSettings({...supplierSettings, paymentTermsOptions: newTerms});
                            }}
                            className="w-full px-3 py-2 border-0 focus:ring-0 outline-none font-medium"
                          />
                        </div>
                        <button
                          onClick={() => {
                            const newTerms = supplierSettings.paymentTermsOptions.filter((_, i) => i !== idx);
                            setSupplierSettings({...supplierSettings, paymentTermsOptions: newTerms});
                          }}
                          className="delete-btn p-2 text-red-600 hover:bg-red-50 rounded-lg transition-all"
                        >
                          <Trash />
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}

            {/* Currency Options */}
            {activeSection === 'currency' && (
              <div className="content-section max-w-4xl">
                <div className="mb-6 flex items-center justify-between">
                  <div>
                    <h2 className="text-2xl font-bold text-gray-900 mb-2">Currency Options</h2>
                    <p className="text-gray-600">Configure supported currency codes</p>
                  </div>
                  <button
                    onClick={() => {
                      setSupplierSettings({
                        ...supplierSettings,
                        currencyOptions: [...supplierSettings.currencyOptions, 'XXX']
                      });
                    }}
                    className="flex items-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all"
                  >
                    <Plus />
                    Add Currency
                  </button>
                </div>

                <div className="settings-card p-6">
                  <div className="grid grid-cols-4 gap-4">
                    {supplierSettings.currencyOptions.map((curr, idx) => (
                      <div key={idx} className="option-item relative group p-4 rounded-lg border border-gray-200">
                        <input
                          type="text"
                          value={curr}
                          onChange={(e) => {
                            const newCurr = [...supplierSettings.currencyOptions];
                            newCurr[idx] = e.target.value.toUpperCase();
                            setSupplierSettings({...supplierSettings, currencyOptions: newCurr});
                          }}
                          className="w-full text-center border-0 focus:ring-0 outline-none font-bold text-lg uppercase"
                          maxLength="3"
                        />
                        <button
                          onClick={() => {
                            const newCurr = supplierSettings.currencyOptions.filter((_, i) => i !== idx);
                            setSupplierSettings({...supplierSettings, currencyOptions: newCurr});
                          }}
                          className="delete-btn absolute top-2 right-2 p-1.5 text-red-600 hover:bg-red-50 rounded-lg transition-all"
                        >
                          <Trash />
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}

            {/* Shipment Modes */}
            {activeSection === 'shipment' && (
              <div className="content-section max-w-4xl">
                <div className="mb-6 flex items-center justify-between">
                  <div>
                    <h2 className="text-2xl font-bold text-gray-900 mb-2">Shipment Modes</h2>
                    <p className="text-gray-600">Define available shipment method options</p>
                  </div>
                  <button
                    onClick={() => {
                      setSupplierSettings({
                        ...supplierSettings,
                        shipmentModeOptions: [...supplierSettings.shipmentModeOptions, 'New Mode']
                      });
                    }}
                    className="flex items-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all"
                  >
                    <Plus />
                    Add Mode
                  </button>
                </div>

                <div className="settings-card p-6">
                  <div className="space-y-3">
                    {supplierSettings.shipmentModeOptions.map((mode, idx) => (
                      <div key={idx} className="option-item flex items-center gap-3 p-3 rounded-lg border border-gray-200">
                        <div className="flex-1">
                          <input
                            type="text"
                            value={mode}
                            onChange={(e) => {
                              const newModes = [...supplierSettings.shipmentModeOptions];
                              newModes[idx] = e.target.value;
                              setSupplierSettings({...supplierSettings, shipmentModeOptions: newModes});
                            }}
                            className="w-full px-3 py-2 border-0 focus:ring-0 outline-none font-medium"
                          />
                        </div>
                        <button
                          onClick={() => {
                            const newModes = supplierSettings.shipmentModeOptions.filter((_, i) => i !== idx);
                            setSupplierSettings({...supplierSettings, shipmentModeOptions: newModes});
                          }}
                          className="delete-btn p-2 text-red-600 hover:bg-red-50 rounded-lg transition-all"
                        >
                          <Trash />
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}

            {/* Payment Methods */}
            {activeSection === 'paymentMethod' && (
              <div className="content-section max-w-4xl">
                <div className="mb-6 flex items-center justify-between">
                  <div>
                    <h2 className="text-2xl font-bold text-gray-900 mb-2">Payment Methods</h2>
                    <p className="text-gray-600">Configure available payment method types</p>
                  </div>
                  <button
                    onClick={() => {
                      setSupplierSettings({
                        ...supplierSettings,
                        paymentMethodOptions: [...supplierSettings.paymentMethodOptions, 'New Method']
                      });
                    }}
                    className="flex items-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all"
                  >
                    <Plus />
                    Add Method
                  </button>
                </div>

                <div className="settings-card p-6">
                  <div className="space-y-3">
                    {supplierSettings.paymentMethodOptions.map((method, idx) => (
                      <div key={idx} className="option-item flex items-center gap-3 p-3 rounded-lg border border-gray-200">
                        <div className="flex-1">
                          <input
                            type="text"
                            value={method}
                            onChange={(e) => {
                              const newMethods = [...supplierSettings.paymentMethodOptions];
                              newMethods[idx] = e.target.value;
                              setSupplierSettings({...supplierSettings, paymentMethodOptions: newMethods});
                            }}
                            className="w-full px-3 py-2 border-0 focus:ring-0 outline-none font-medium"
                          />
                        </div>
                        <button
                          onClick={() => {
                            const newMethods = supplierSettings.paymentMethodOptions.filter((_, i) => i !== idx);
                            setSupplierSettings({...supplierSettings, paymentMethodOptions: newMethods});
                          }}
                          className="delete-btn p-2 text-red-600 hover:bg-red-50 rounded-lg transition-all"
                        >
                          <Trash />
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}

            {/* Date Basis */}
            {activeSection === 'dateBasis' && (
              <div className="content-section max-w-4xl">
                <div className="mb-6 flex items-center justify-between">
                  <div>
                    <h2 className="text-2xl font-bold text-gray-900 mb-2">Terms Date Basis</h2>
                    <p className="text-gray-600">Set date calculation options for payment terms</p>
                  </div>
                  <button
                    onClick={() => {
                      setSupplierSettings({
                        ...supplierSettings,
                        termsDateBasisOptions: [...supplierSettings.termsDateBasisOptions, 'New Basis']
                      });
                    }}
                    className="flex items-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all"
                  >
                    <Plus />
                    Add Basis
                  </button>
                </div>

                <div className="settings-card p-6">
                  <div className="space-y-3">
                    {supplierSettings.termsDateBasisOptions.map((basis, idx) => (
                      <div key={idx} className="option-item flex items-center gap-3 p-3 rounded-lg border border-gray-200">
                        <div className="flex-1">
                          <input
                            type="text"
                            value={basis}
                            onChange={(e) => {
                              const newBasis = [...supplierSettings.termsDateBasisOptions];
                              newBasis[idx] = e.target.value;
                              setSupplierSettings({...supplierSettings, termsDateBasisOptions: newBasis});
                            }}
                            className="w-full px-3 py-2 border-0 focus:ring-0 outline-none font-medium"
                          />
                        </div>
                        <button
                          onClick={() => {
                            const newBasis = supplierSettings.termsDateBasisOptions.filter((_, i) => i !== idx);
                            setSupplierSettings({...supplierSettings, termsDateBasisOptions: newBasis});
                          }}
                          className="delete-btn p-2 text-red-600 hover:bg-red-50 rounded-lg transition-all"
                        >
                          <Trash />
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}
          </div>
        </main>
      </div>
    </div>
  );
}

ReactDOM.render(<SupplierSettings />, document.getElementById('root'));
</script>
</body>
</html>